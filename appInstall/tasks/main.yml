---

- name: Create a directory if it does not exist
  ansible.builtin.file:
    path: "{{ go_app_location }}"
    state: directory
    mode: '0755'

- name: Download jre
  ansible.builtin.get_url:
    url: https://nexusrm.easlab.co.uk/repository/eas-hosted-bin/example-jar.tar.gz
    dest: "{{ go_app_location }}/example-jar.tar.gz"
    mode: '0777'

- name: unzip jar
  ansible.builtin.command:
    cmd: tar -xf example-jar.tar.gz
    chdir: "{{ go_app_location }}"
    mode: '0777'

- name: make java-hello-app.service
  blockinfile:

    dest: /lib/systemd/system/java-hello-app.service
    block: |
      [Unit]
      Description=Java hello app

      [Service]
      Restart=on-failure
      ExecStart=java -jar {{ go_app_location }}/app.jar
      User=nobody
      Group=nogroup

      [Install]
      WantedBy=multi-user.target
    insertafter: EOF
    create: yes

- name: daemon-reload 
  command: systemctl daemon-reload

- name: enable myapp on start up
  command: systemctl enable java-hello-app