---
- name: Create a directory if it does not exist
  ansible.builtin.file:
    path: "{{ apps_location }}"
    state: directory
    mode: '0755'


- name: Download app.jar 
  ansible.builtin.get_url:
    url: https://nexusrm.easlab.co.uk/repository/eas-hosted-bin/server.jar
    dest: "{{ apps_location }}/server.jar"
    mode: '0777'
    validate_certs: no

- name: make java-hello-app.service
  blockinfile:

    dest: /lib/systemd/system/java-hello-app.service
    block: |
      [Unit]
      Description=Java hello app

      [Service]
      After=network.target
      Restart=on-failure
      ExecStart=java -Xmx1024M -Xms1024M -jar {{ apps_location }}/server.jar nogui
      User=root
      Group=nogroup

      [Install]
      WantedBy=multi-user.target
    insertafter: EOF
    create: yes

- name: daemon-reload 
  command: systemctl daemon-reload

- name: enable myapp on start up
  command: systemctl enable java-hello-app